# ========================================
# MySingle Package - Environment Variables
# ========================================
# Copy this file to .env and update with your values
# Usage: Load via pydantic-settings in your service

# ----------------------------------------
# Project Configuration
# ----------------------------------------
PROJECT_NAME=MySingle Quant
ENVIRONMENT=development
# Options: development, staging, production
DEBUG=true

# ----------------------------------------
# Database - MongoDB
# ----------------------------------------
MONGODB_SERVER=localhost:27017
MONGODB_USER=
MONGODB_PASSWORD=
MONGODB_DB=mysingle_dev
MOCK_DATABASE=false
# Set to true for testing without actual MongoDB

# ----------------------------------------
# Database - Redis
# ----------------------------------------
REDIS_HOST=localhost
REDIS_PORT=6379

# Redis DB Allocation Strategy (0-15 available)
# CommonSettings provides dedicated DB allocation for each component:
REDIS_DB_USER=0          # User cache and authentication
REDIS_DB_MARKET=1        # Market data cache
REDIS_DB_GRPC=2          # gRPC response cache (L2 layer)
REDIS_DB_RATE_LIMIT=3    # Rate limiting counters
REDIS_DB_SESSION=4       # Session store

# Legacy DB allocation (deprecated - use above instead):
# REDIS_DB=0  # Default database (use REDIS_DB_USER instead)

REDIS_PASSWORD=
REDIS_MAX_CONNECTIONS=50
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5

# ----------------------------------------
# Authentication & Security
# ----------------------------------------
SECRET_KEY=your-secret-key-change-in-production
# Generate: openssl rand -hex 32
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Kong JWT Configuration
KONG_JWT_SECRET_SERVICE_NAME=your-jwt-secret
# Kong Gateway uses this to validate JWT tokens

# ----------------------------------------
# Kong API Gateway
# ----------------------------------------
USE_API_GATEWAY=true
API_GATEWAY_URL=http://localhost:8000
# Set to false for local development without Kong

# ----------------------------------------
# OAuth2 Providers
# ----------------------------------------
# Google OAuth
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=http://localhost:8080/auth/google/callback

# Kakao OAuth
KAKAO_CLIENT_ID=
KAKAO_CLIENT_SECRET=
KAKAO_REDIRECT_URI=http://localhost:8080/auth/kakao/callback

# Naver OAuth
NAVER_CLIENT_ID=
NAVER_CLIENT_SECRET=
NAVER_REDIRECT_URI=http://localhost:8080/auth/naver/callback

# ----------------------------------------
# CORS Configuration
# ----------------------------------------
BACKEND_CORS_ORIGINS=["http://localhost:3000","http://localhost:8080"]
# JSON array format for multiple origins

# ----------------------------------------
# Email Configuration
# ----------------------------------------
SMTP_TLS=true
SMTP_SSL=false
SMTP_PORT=587
SMTP_HOST=smtp.gmail.com
SMTP_USER=
SMTP_PASSWORD=
EMAILS_FROM_EMAIL=noreply@mysingle.io
EMAILS_FROM_NAME=MySingle Quant

# ----------------------------------------
# Testing Configuration
# ----------------------------------------
# Auth Bypass (Development Only)
MYSINGLE_AUTH_BYPASS=false
# Set to true to bypass authentication in tests
# WARNING: Automatically disabled in production

# First Super Admin User
FIRST_SUPERUSER_EMAIL=admin@mysingle.io
FIRST_SUPERUSER_PASSWORD=changeme

# ----------------------------------------
# Service-Specific Settings
# ----------------------------------------
# Add your service-specific environment variables below
# Example:
# MY_SERVICE_API_KEY=your-api-key
# MY_SERVICE_TIMEOUT=30

# ========================================
# gRPC Server Configuration
# ========================================
# All microservices inherit these settings from CommonSettings.
# Override in service-specific Settings class if needed.

# ----------------------------------------
# gRPC Server Core Settings
# ----------------------------------------
GRPC_SERVER_PORT=50051
# Default gRPC server port (each service should use different port)

GRPC_SERVER_MAX_WORKERS=10
# Number of worker threads (recommended: CPU cores * 2)

GRPC_SERVER_ENABLE_REFLECTION=false
# Enable gRPC reflection for development (grpcurl, Postman)
# WARNING: Must be false in production

# ----------------------------------------
# gRPC Interceptor Flags
# ----------------------------------------
GRPC_ENABLE_AUTH=true
# Validate X-User-Id and Correlation-Id headers

GRPC_ENABLE_RATE_LIMITING=true
# Enable per-user rate limiting (DDoS protection)

GRPC_ENABLE_METRICS=true
# Collect Prometheus metrics (latency, request count, errors)

GRPC_ENABLE_ERROR_HANDLING=true
# Auto-convert exceptions to gRPC status codes

# ----------------------------------------
# gRPC Rate Limiting
# ----------------------------------------
GRPC_RATE_LIMIT_MAX_REQUESTS=1000
# Maximum requests per user within time window

GRPC_RATE_LIMIT_WINDOW_SECONDS=60
# Time window in seconds (e.g., 1000 requests per 60 seconds)

# ----------------------------------------
# gRPC Server Advanced Options
# ----------------------------------------
GRPC_KEEPALIVE_TIME_MS=30000
# Client keepalive ping interval (milliseconds)

GRPC_KEEPALIVE_TIMEOUT_MS=10000
# Keepalive timeout waiting for pong (milliseconds)

GRPC_MAX_CONCURRENT_STREAMS=100
# Maximum concurrent streams per connection

GRPC_MAX_MESSAGE_LENGTH=10485760
# Maximum message size in bytes (default: 10MB)

# ----------------------------------------
# gRPC Cache Configuration (2-Tier)
# ----------------------------------------
GRPC_CACHE_L1_TTL_SECONDS=300
# L1 in-memory cache TTL (5 minutes)

GRPC_CACHE_L1_MAX_SIZE=100
# Maximum items in L1 cache

GRPC_CACHE_L2_TTL_SECONDS=3600
# L2 Redis cache TTL (1 hour, longer than L1)

GRPC_CACHE_DEFAULT_TTL_SECONDS=300
# Default TTL when @grpc_cached decorator doesn't specify ttl

# ========================================
# Service-Specific Overrides (Examples)
# ========================================
# Uncomment and customize for each service:

# Strategy Service
# STRATEGY_GRPC_PORT=50052
# STRATEGY_CACHE_L1_TTL_SECONDS=600

# Market Data Service
# MARKET_DATA_GRPC_PORT=50053
# MARKET_DATA_RATE_LIMIT_MAX_REQUESTS=5000

# ML Service
# ML_GRPC_PORT=50054
# ML_MAX_MESSAGE_LENGTH=52428800  # 50MB for large models

# GenAI Service
# GENAI_GRPC_PORT=50055
